pkgname=sdl2-mixer
pkgver=2.6.2
pkgrel=2
pkgdesc="an audio mixer library based on the SDL2 library"
arch=('mips')
url="https://www.libsdl.org/projects/SDL_mixer/"
license=('MIT')
depends=('sdl2' 'libxmp' 'libvorbis' 'libogg')
makedepends=()
optdepends=()
source=("git+https://github.com/libsdl-org/SDL_mixer#commit=75f318100d220e236c4fcc5a3d0c9ba33d064f3f")
sha256sums=('SKIP')

build() {
    cd "$srcdir/SDL_mixer"
    mkdir -p build && cd build
    cmake -DCMAKE_TOOLCHAIN_FILE=$PSPDEV/psp/share/pspdev.cmake -DCMAKE_INSTALL_PREFIX=${pkgdir}/psp -DBUILD_SHARED_LIBS=OFF \
          -DCMAKE_POSITION_INDEPENDENT_CODE=OFF -DSDL2MIXER_DEPS_SHARED=OFF -DSDL2MIXER_OPUS=OFF -DSDL2MIXER_MIDI=OFF \
          -DSDL2MIXER_FLAC=OFF  -DSDL2MIXER_VORBIS=VORBISFILE -DSDL2MIXER_VORBIS_VORBISFILE_SHARED=OFF \
          -DSDL2MIXER_MOD=ON -DSDL2MIXER_MOD_MODPLUG=OFF -DSDL2MIXER_MOD_XMP=ON -DSDL2MIXER_SAMPLES=OFF ..
    make
}

package() {
    cd "$srcdir/SDL_mixer/build"
    make --quiet $MAKEFLAGS install

    mv "$pkgdir/psp/share/licenses/SDL2_mixer" "$pkgdir/psp/share/licenses/$pkgname"
}

